<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sistema de Marcenaria - Gestão Completa</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    /* ==================== VARIÁVEIS CSS ==================== */
    :root {
      /* Cores do sistema - PODE ALTERAR */
      --cor-primaria: #2c3e50;
      --cor-secundaria: #3498db;
      --cor-sucesso: #27ae60;
      --cor-aviso: #f39c12;
      --cor-perigo: #e74c3c;
      --cor-info: #17a2b8;
      --cor-clara: #f5f7fa;
      --cor-escura: #343a40;
      
      /* Tamanhos e espaçamentos - PODE ALTERAR */
      --navbar-altura: 80px;
      --navbar-altura-mobile: 70px;
      --sidebar-largura: 260px;
      --sidebar-largura-mobile: 70px;
      --card-border-radius: 12px;
      --card-border-size: 4px;
      --transition-speed: 0.3s;
      
      /* Fontes - PODE ALTERAR */
      --fonte-principal: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      --fonte-tamanho-base: 16px;
      --fonte-tamanho-pequeno: 0.9rem;
      --fonte-tamanho-grande: 1.2rem;
      
      /* Sombras - PODE ALTERAR */
      --sombra-leve: 0 2px 5px rgba(0,0,0,0.05);
      --sombra-media: 0 2px 10px rgba(0,0,0,0.1);
      --sombra-forte: 0 2px 15px rgba(0,0,0,0.08);
      
      /* Bordas - PODE ALTERAR */
      --border-radius-padrao: 6px;
      --border-radius-grande: 12px;
      --border-color: #dee2e6;
    }
    
    /* ==================== ESTILOS BASE ==================== */
    body {
      background: var(--cor-clara);
      font-family: var(--fonte-principal);
      font-size: var(--fonte-tamanho-base);
      padding-top: var(--navbar-altura);
    }
    
    /* ==================== NAVBAR ==================== */
    .navbar-superior {
      background: var(--cor-primaria);
      box-shadow: var(--sombra-media);
      padding: 10px 0;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1030;
      height: var(--navbar-altura);
    }
    
    .navbar-brand {
      font-weight: 600;
      font-size: var(--fonte-tamanho-grande);
      color: white;
    }
    
    .navbar-brand i {
      margin-right: 10px;
    }
    
    .nav-link-top {
      color: rgba(255,255,255,0.9) !important;
      padding: 10px 15px !important;
      margin: 0 5px;
      border-radius: var(--border-radius-padrao);
      transition: all var(--transition-speed);
      cursor: pointer;
    }
    
    .nav-link-top:hover, .nav-link-top.active {
      background: rgba(255,255,255,0.1);
      color: white !important;
    }
    
    .nav-link-top i {
      margin-right: 8px;
      font-size: 1.1rem;
    }
    
    /* Botões de Ação na Navbar */
    .navbar-actions .btn {
      margin-left: 5px;
    }
    
    .btn-impressao {
      background: var(--cor-sucesso);
      border: none;
      color: white;
    }
    
    .btn-impressao:hover {
      background: #219653;
      color: white;
    }
    
    /* ==================== CONTEÚDO PRINCIPAL ==================== */
    .content {
      padding: 20px;
      animation: fadeIn var(--transition-speed);
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* ==================== CARDS ==================== */
    .card {
      border: none;
      box-shadow: var(--sombra-forte);
      border-radius: var(--card-border-radius);
      margin-bottom: 20px;
      border-top: var(--card-border-size) solid var(--cor-secundaria);
    }
    
    .card-header {
      background: white;
      border-bottom: 1px solid var(--border-color);
      font-weight: 600;
      padding: 15px 20px;
      border-radius: var(--card-border-radius) var(--card-border-radius) 0 0 !important;
    }
    
    /* ==================== TABELAS EDITÁVEIS ==================== */
    .table {
      margin-bottom: 0;
    }
    
    .table th {
      font-weight: 600;
      border-top: none;
      background: #f8f9fa;
    }
    
    /* Células editáveis */
    .editable-cell {
      cursor: pointer;
      position: relative;
      transition: background-color 0.2s;
    }
    
    .editable-cell:hover {
      background-color: #f8f9fa !important;
    }
    
    .editable-cell.editing {
      background-color: #e3f2fd !important;
      padding: 0 !important;
    }
    
    .cell-input {
      width: 100%;
      height: 100%;
      border: 2px solid var(--cor-secundaria);
      padding: 4px 8px;
      font-size: inherit;
      font-family: inherit;
      border-radius: var(--border-radius-padrao);
      background: white;
      box-sizing: border-box;
    }
    
    .cell-select {
      width: 100%;
      height: 100%;
      border: 2px solid var(--cor-secundaria);
      padding: 4px 8px;
      font-size: inherit;
      font-family: inherit;
      border-radius: var(--border-radius-padrao);
      background: white;
      box-sizing: border-box;
    }
    
    .cell-textarea {
      width: 100%;
      height: 100%;
      border: 2px solid var(--cor-secundaria);
      padding: 4px 8px;
      font-size: inherit;
      font-family: inherit;
      border-radius: var(--border-radius-padrao);
      background: white;
      box-sizing: border-box;
      resize: vertical;
      min-height: 80px;
    }
    
    /* Indicador de célula editável */
    .editable-cell::after {
      content: "✎";
      position: absolute;
      right: 5px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.8rem;
      color: var(--cor-secundaria);
      opacity: 0;
      transition: opacity 0.2s;
    }
    
    .editable-cell:hover::after {
      opacity: 1;
    }
    
    /* Colunas não editáveis */
    .non-editable-cell {
      cursor: default;
      background-color: #f8f9fa;
    }
    
    /* ==================== BADGES ==================== */
    .badge-estoque-baixo {
      background: var(--cor-perigo);
    }
    
    .badge-estoque-ok {
      background: var(--cor-sucesso);
    }
    
    .badge-estoque-medio {
      background: var(--cor-aviso);
    }
    
    /* ==================== FORMULÁRIOS ==================== */
    .form-control:focus {
      border-color: var(--cor-secundaria);
      box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
    }
    
    /* ==================== ESTATÍSTICAS ==================== */
    .stats-card {
      border-left: var(--card-border-size) solid var(--cor-secundaria);
      padding: 20px;
      margin-bottom: 20px;
      background: white;
      border-radius: var(--border-radius-padrao);
      box-shadow: var(--sombra-leve);
    }
    
    .stats-card h3 {
      margin: 0;
      font-weight: bold;
    }
    
    /* ==================== IMPRESSÃO ==================== */
    @media print {
      .no-print {
        display: none !important;
      }
      
      body {
        padding-top: 0;
        background: white;
      }
      
      .card {
        box-shadow: none;
        border: 1px solid var(--border-color);
      }
      
      .content {
        padding: 0;
      }
      
      .editable-cell::after {
        display: none !important;
      }
    }
    
    /* ==================== ESTADOS VAZIOS ==================== */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #6c757d;
    }
    
    .empty-state i {
      font-size: 3rem;
      margin-bottom: 15px;
      color: #dee2e6;
    }
    
    /* ==================== SALDO FINANCEIRO ==================== */
    .saldo-positivo {
      color: var(--cor-sucesso);
      font-weight: bold;
    }
    
    .saldo-negativo {
      color: var(--cor-perigo);
      font-weight: bold;
    }
    
    /* ==================== MODAL DE CONFIGURAÇÃO ==================== */
    .config-group {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius-padrao);
      background: #f8f9fa;
    }
    
    .config-group h6 {
      margin-bottom: 15px;
      color: var(--cor-primaria);
      border-bottom: 2px solid var(--cor-secundaria);
      padding-bottom: 5px;
    }
    
    .color-preview {
      width: 30px;
      height: 30px;
      border-radius: var(--border-radius-padrao);
      display: inline-block;
      margin-right: 10px;
      border: 1px solid var(--border-color);
    }
    
    /* ==================== RESPONSIVIDADE ==================== */
    @media (max-width: 768px) {
      body {
        padding-top: var(--navbar-altura-mobile);
      }
      
      .nav-link-top span {
        display: none;
      }
      
      .nav-link-top i {
        margin-right: 0;
        font-size: 1.3rem;
      }
      
      .navbar-brand span {
        font-size: 1.2rem;
      }
      
      .editable-cell::after {
        display: none;
      }
    }
  </style>
</head>
<body>

  <!-- Navbar Superior Fixa -->
  <nav class="navbar navbar-superior navbar-expand-lg">
    <div class="container-fluid">
      <!-- Logo -->
      <a class="navbar-brand" href="#" onclick="mostrarDashboard(event)">
        <i class="bi bi-tools"></i>
        <span id="nomeSistema">MarcenariaPro</span>
      </a>
      
      <!-- Botão Hamburguer -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarPrincipal">
        <span class="navbar-toggler-icon" style="filter: invert(1);">☰</span>
      </button>
      
      <!-- Menu -->
      <div class="collapse navbar-collapse" id="navbarPrincipal">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link-top active" onclick="mostrarSecao('clientes')">
              <i class="bi bi-people"></i>
              <span>Clientes</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link-top" onclick="mostrarSecao('fornecedores')">
              <i class="bi bi-truck"></i>
              <span>Fornecedores</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link-top" onclick="mostrarSecao('orcamentos')">
              <i class="bi bi-calculator"></i>
              <span>Orçamentos</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link-top" onclick="mostrarSecao('estoque')">
              <i class="bi bi-box-seam"></i>
              <span>Estoque</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link-top" onclick="mostrarSecao('financeiro')">
              <i class="bi bi-cash-coin"></i>
              <span>Financeiro</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link-top" onclick="mostrarSecao('patrimonio')">
              <i class="bi bi-building"></i>
              <span>Patrimônio</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link-top" onclick="mostrarSecao('contratos')">
              <i class="bi bi-file-earmark-text"></i>
              <span>Contratos</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link-top" onclick="mostrarSecao('relatorios')">
              <i class="bi bi-graph-up"></i>
              <span>Relatórios</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link-top" onclick="mostrarSecao('configuracoes')">
              <i class="bi bi-gear"></i>
              <span>Configurações</span>
            </a>
          </li>
        </ul>
        
        <!-- Botões de Ação -->
        <div class="navbar-actions">
          <button class="btn btn-outline-light btn-sm" onclick="imprimirSecaoAtual()">
            <i class="bi bi-printer"></i>
            <span class="d-none d-md-inline"> Imprimir</span>
          </button>
          <button class="btn btn-impressao btn-sm" onclick="exportarDados()">
            <i class="bi bi-download"></i>
            <span class="d-none d-md-inline"> Exportar</span>
          </button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Conteúdo Principal -->
  <div class="container-fluid content">
    
    <!-- Dashboard -->
    <div id="dashboard">
      <div class="row mb-4">
        <div class="col-12">
          <h2 id="tituloDashboard">Dashboard</h2>
          <p class="text-muted" id="subtituloDashboard">Visão geral do sistema</p>
        </div>
      </div>

      <!-- Estatísticas -->
      <div class="row mb-4">
        <div class="col-md-3 col-sm-6">
          <div class="stats-card">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h6 class="text-muted">Total Clientes</h6>
                <h3 id="totalClientes">0</h3>
              </div>
              <i class="bi bi-people text-primary" style="font-size: 2rem;"></i>
            </div>
          </div>
        </div>
        <div class="col-md-3 col-sm-6">
          <div class="stats-card">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h6 class="text-muted">Orçamentos</h6>
                <h3 id="totalOrcamentos">0</h3>
              </div>
              <i class="bi bi-calculator text-warning" style="font-size: 2rem;"></i>
            </div>
          </div>
        </div>
        <div class="col-md-3 col-sm-6">
          <div class="stats-card">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h6 class="text-muted">Estoque Baixo</h6>
                <h3 id="estoqueBaixo">0</h3>
              </div>
              <i class="bi bi-exclamation-triangle text-danger" style="font-size: 2rem;"></i>
            </div>
          </div>
        </div>
        <div class="col-md-3 col-sm-6">
          <div class="stats-card">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h6 class="text-muted">Saldo</h6>
                <h3 id="saldoResumo">R$ 0,00</h3>
              </div>
              <i class="bi bi-cash-stack text-success" style="font-size: 2rem;"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Ações Rápidas -->
      <div class="row">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">Ações Rápidas</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-3 col-sm-6 mb-3">
                  <button class="btn btn-primary w-100" onclick="mostrarSecao('clientes'); adicionarClienteRapido();">
                    <i class="bi bi-person-plus me-2"></i>Novo Cliente
                  </button>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                  <button class="btn btn-success w-100" onclick="mostrarSecao('orcamentos'); adicionarOrcamentoRapido();">
                    <i class="bi bi-calculator me-2"></i>Novo Orçamento
                  </button>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                  <button class="btn btn-warning w-100" onclick="mostrarSecao('estoque'); adicionarEstoqueRapido();">
                    <i class="bi bi-box me-2"></i>Adicionar Estoque
                  </button>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                  <button class="btn btn-info w-100" onclick="imprimirRelatorioCompleto()">
                    <i class="bi bi-printer me-2"></i>Imprimir Relatório
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Clientes -->
    <div id="clientes" class="secao" style="display: none;">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="bi bi-people me-2"></i>Clientes</h5>
          <div>
            <button class="btn btn-primary btn-sm" onclick="adicionarCliente()">
              <i class="bi bi-plus-circle me-2"></i>Novo Cliente
            </button>
            <button class="btn btn-outline-secondary btn-sm ms-2" onclick="ativarEdicaoTodos('clientes')">
              <i class="bi bi-pencil-square me-2"></i>Editar Tudo
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-search"></i></span>
                <input type="text" class="form-control" id="buscarCliente" placeholder="Buscar cliente..." onkeyup="filtrarClientes()">
              </div>
            </div>
            <div class="col-md-6 text-end">
              <small class="text-muted">Clique duas vezes em uma célula para editar</small>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-light">
                <tr>
                  <th>Nome</th>
                  <th>Telefone</th>
                  <th>E-mail</th>
                  <th>Endereço</th>
                  <th>Cadastro</th>
                  <th class="no-print">Ações</th>
                </tr>
              </thead>
              <tbody id="listaClientes">
                <!-- Dados serão carregados aqui -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Fornecedores -->
    <div id="fornecedores" class="secao" style="display: none;">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="bi bi-truck me-2"></i>Fornecedores</h5>
          <div>
            <button class="btn btn-success btn-sm" onclick="adicionarFornecedor()">
              <i class="bi bi-plus-circle me-2"></i>Novo Fornecedor
            </button>
            <button class="btn btn-outline-secondary btn-sm ms-2" onclick="ativarEdicaoTodos('fornecedores')">
              <i class="bi bi-pencil-square me-2"></i>Editar Tudo
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-light">
                <tr>
                  <th>Razão Social</th>
                  <th>CNPJ</th>
                  <th>Telefone</th>
                  <th>E-mail</th>
                  <th class="no-print">Ações</th>
                </tr>
              </thead>
              <tbody id="listaFornecedores">
                <!-- Dados serão carregados aqui -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Orçamentos -->
    <div id="orcamentos" class="secao" style="display: none;">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="bi bi-calculator me-2"></i>Orçamentos</h5>
          <div>
            <button class="btn btn-primary btn-sm" onclick="adicionarOrcamento()">
              <i class="bi bi-plus-circle me-2"></i>Novo Orçamento
            </button>
            <button class="btn btn-outline-secondary btn-sm ms-2" onclick="ativarEdicaoTodos('orcamentos')">
              <i class="bi bi-pencil-square me-2"></i>Editar Tudo
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="row mb-4">
            <div class="col-md-4">
              <select class="form-select" id="filtroStatus" onchange="filtrarOrcamentos()">
                <option value="todos">Todos os Status</option>
                <option value="pendente">Pendentes</option>
                <option value="aprovado">Aprovados</option>
                <option value="recusado">Recusados</option>
              </select>
            </div>
            <div class="col-md-8 text-end">
              <small class="text-muted">Clique duas vezes para editar. Status pode ser alterado.</small>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-light">
                <tr>
                  <th class="non-editable-cell">Nº</th>
                  <th>Cliente</th>
                  <th>Descrição</th>
                  <th>Valor</th>
                  <th class="non-editable-cell">Data</th>
                  <th>Status</th>
                  <th class="no-print">Ações</th>
                </tr>
              </thead>
              <tbody id="listaOrcamentos">
                <!-- Dados serão carregados aqui -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Estoque -->
    <div id="estoque" class="secao" style="display: none;">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="bi bi-box-seam me-2"></i>Estoque</h5>
          <div>
            <button class="btn btn-warning btn-sm" onclick="adicionarItemEstoque()">
              <i class="bi bi-plus-circle me-2"></i>Novo Item
            </button>
            <button class="btn btn-outline-secondary btn-sm ms-2" onclick="ativarEdicaoTodos('estoque')">
              <i class="bi bi-pencil-square me-2"></i>Editar Tudo
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="alert alert-warning d-flex align-items-center no-print" role="alert">
            <i class="bi bi-exclamation-triangle me-3"></i>
            <div>Itens com estoque baixo são marcados em vermelho. Clique duas vezes para editar valores.</div>
          </div>
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-light">
                <tr>
                  <th>Produto</th>
                  <th>Quantidade</th>
                  <th>Mínimo</th>
                  <th>Fornecedor</th>
                  <th>Valor Unitário</th>
                  <th class="non-editable-cell">Status</th>
                  <th class="no-print">Ações</th>
                </tr>
              </thead>
              <tbody id="listaEstoque">
                <!-- Dados serão carregados aqui -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Financeiro -->
    <div id="financeiro" class="secao" style="display: none;">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="bi bi-cash-coin me-2"></i>Financeiro</h5>
          <div>
            <button class="btn btn-outline-secondary btn-sm" onclick="imprimirRelatorioFinanceiro()">
              <i class="bi bi-printer me-2"></i>Imprimir Relatório
            </button>
            <button class="btn btn-outline-primary btn-sm ms-2" onclick="ativarEdicaoTodos('financeiro')">
              <i class="bi bi-pencil-square me-2"></i>Editar Valores
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <div class="card mb-3">
                <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                  <h6 class="mb-0">Contas a Receber</h6>
                  <button class="btn btn-light btn-sm" onclick="adicionarContaReceber()">
                    <i class="bi bi-plus"></i> Nova
                  </button>
                </div>
                <div class="card-body">
                  <div class="table-responsive">
                    <table class="table table-sm">
                      <thead>
                        <tr>
                          <th>Descrição</th>
                          <th>Valor</th>
                          <th class="no-print">Ações</th>
                        </tr>
                      </thead>
                      <tbody id="listaReceber">
                        <!-- Dados serão carregados aqui -->
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card mb-3">
                <div class="card-header bg-danger text-white d-flex justify-content-between align-items-center">
                  <h6 class="mb-0">Contas a Pagar</h6>
                  <button class="btn btn-light btn-sm" onclick="adicionarContaPagar()">
                    <i class="bi bi-plus"></i> Nova
                  </button>
                </div>
                <div class="card-body">
                  <div class="table-responsive">
                    <table class="table table-sm">
                      <thead>
                        <tr>
                          <th>Descrição</th>
                          <th>Valor</th>
                          <th class="no-print">Ações</th>
                        </tr>
                      </thead>
                      <tbody id="listaPagar">
                        <!-- Dados serão carregados aqui -->
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row mt-4">
            <div class="col-md-12">
              <div class="alert" id="saldoAlert">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <strong>Saldo Atual:</strong>
                    <span id="saldoAtual" class="ms-2">R$ 0,00</span>
                  </div>
                  <div>
                    <span class="me-3">Receitas: R$ <span id="totalReceitas">0,00</span></span>
                    <span>Despesas: R$ <span id="totalDespesas">0,00</span></span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Patrimônio -->
    <div id="patrimonio" class="secao" style="display: none;">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="bi bi-building me-2"></i>Patrimônio</h5>
          <div>
            <button class="btn btn-info btn-sm text-white" onclick="adicionarPatrimonio()">
              <i class="bi bi-plus-circle me-2"></i>Novo Item
            </button>
            <button class="btn btn-outline-secondary btn-sm ms-2" onclick="ativarEdicaoTodos('patrimonio')">
              <i class="bi bi-pencil-square me-2"></i>Editar Tudo
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-light">
                <tr>
                  <th>Item</th>
                  <th class="non-editable-cell">Data Aquisição</th>
                  <th>Valor</th>
                  <th>Departamento</th>
                  <th>Estado</th>
                  <th class="no-print">Ações</th>
                </tr>
              </thead>
              <tbody id="listaPatrimonio">
                <!-- Dados serão carregados aqui -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Contratos -->
    <div id="contratos" class="secao" style="display: none;">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="bi bi-file-earmark-text me-2"></i>Contratos</h5>
          <div>
            <button class="btn btn-primary btn-sm" onclick="adicionarContrato()">
              <i class="bi bi-plus-circle me-2"></i>Novo Contrato
            </button>
            <button class="btn btn-outline-secondary btn-sm ms-2" onclick="ativarEdicaoTodos('contratos')">
              <i class="bi bi-pencil-square me-2"></i>Editar Tudo
            </button>
          </div>
        </div>
        <div class="card-body">
          <div id="listaContratos">
            <!-- Contratos serão carregados aqui -->
          </div>
        </div>
      </div>
    </div>

    <!-- Relatórios -->
    <div id="relatorios" class="secao" style="display: none;">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0"><i class="bi bi-graph-up me-2"></i>Relatórios</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4 mb-4">
              <div class="card text-center h-100">
                <div class="card-body">
                  <i class="bi bi-cash-stack text-success" style="font-size: 3rem;"></i>
                  <h5 class="mt-3">Financeiro</h5>
                  <button class="btn btn-success w-100 mt-2" onclick="imprimirRelatorioFinanceiro()">
                    <i class="bi bi-printer me-2"></i>Imprimir Relatório
                  </button>
                </div>
              </div>
            </div>
            <div class="col-md-4 mb-4">
              <div class="card text-center h-100">
                <div class="card-body">
                  <i class="bi bi-box text-warning" style="font-size: 3rem;"></i>
                  <h5 class="mt-3">Estoque</h5>
                  <button class="btn btn-warning w-100 mt-2" onclick="imprimirRelatorioEstoque()">
                    <i class="bi bi-printer me-2"></i>Imprimir Relatório
                  </button>
                </div>
              </div>
            </div>
            <div class="col-md-4 mb-4">
              <div class="card text-center h-100">
                <div class="card-body">
                  <i class="bi bi-people text-primary" style="font-size: 3rem;"></i>
                  <h5 class="mt-3">Clientes</h5>
                  <button class="btn btn-primary w-100 mt-2" onclick="imprimirRelatorioClientes()">
                    <i class="bi bi-printer me-2"></i>Imprimir Relatório
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Configurações -->
    <div id="configuracoes" class="secao" style="display: none;">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="bi bi-gear me-2"></i>Configurações do Sistema</h5>
          <div>
            <button class="btn btn-primary btn-sm" onclick="salvarConfiguracoes()">
              <i class="bi bi-save me-2"></i>Salvar Configurações
            </button>
          </div>
        </div>
        <div class="card-body">
          <!-- Configurações removidas para simplificação -->
          <div class="alert alert-info">
            <i class="bi bi-info-circle me-2"></i>
            <strong>Instruções de Edição:</strong>
            <ul class="mb-0 mt-2">
              <li>Clique <strong>duas vezes</strong> em qualquer célula da tabela para editá-la</li>
              <li>Pressione <strong>Enter</strong> para salvar as alterações</li>
              <li>Pressione <strong>Escape</strong> para cancelar a edição</li>
              <li>Use o botão <strong>"Editar Tudo"</strong> para habilitar edição em todas as células</li>
              <li>Colunas com fundo cinza não podem ser editadas (geradas automaticamente)</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <script>
    // ==================== VARIÁVEIS GLOBAIS ====================
    const $ = (s) => document.querySelector(s);
    const $$ = (s) => document.querySelectorAll(s);
    
    let secaoAtual = 'dashboard';
    let editandoClienteId = null;
    let editandoOrcamentoId = null;
    let celulaEditando = null;
    let modoEdicaoTodos = false;

    // Dados do sistema
    let clientes = JSON.parse(localStorage.getItem('clientes') || '[]');
    let fornecedores = JSON.parse(localStorage.getItem('fornecedores') || '[]');
    let orcamentos = JSON.parse(localStorage.getItem('orcamentos') || '[]');
    let estoque = JSON.parse(localStorage.getItem('estoque') || '[]');
    let receber = JSON.parse(localStorage.getItem('receber') || '[]');
    let pagar = JSON.parse(localStorage.getItem('pagar') || '[]');
    let patrimonio = JSON.parse(localStorage.getItem('patrimonio') || '[]');
    let contratos = JSON.parse(localStorage.getItem('contratos') || '[]');

    // ==================== SISTEMA DE EDIÇÃO DE CÉLULAS ====================
    
    function ativarEdicaoTodos(secao) {
      modoEdicaoTodos = !modoEdicaoTodos;
      const botao = $(`#${secao} .btn-outline-secondary`);
      
      if (modoEdicaoTodos) {
        botao.classList.remove('btn-outline-secondary');
        botao.classList.add('btn-success');
        botao.innerHTML = '<i class="bi bi-check-square me-2"></i>Salvar Tudo';
        
        // Adiciona a classe editable-cell a todas as células editáveis
        $$(`#${secao} .editable-cell`).forEach(cell => {
          cell.classList.add('editing-todos');
        });
        
        Swal.fire({
          title: 'Modo Edição Ativado',
          text: 'Todas as células estão editáveis. Clique para editar.',
          icon: 'info',
          timer: 2000
        });
      } else {
        botao.classList.remove('btn-success');
        botao.classList.add('btn-outline-secondary');
        botao.innerHTML = '<i class="bi bi-pencil-square me-2"></i>Editar Tudo';
        
        // Remove a classe e salva todas as alterações
        $$(`#${secao} .editing-todos`).forEach(cell => {
          cell.classList.remove('editing-todos');
        });
        
        salvarAlteracoesEmMassa(secao);
      }
    }

    function tornarCelulaEditavel(cell, itemId, campo, tipo = 'text') {
      cell.classList.add('editable-cell');
      
      cell.addEventListener('dblclick', function(e) {
        e.stopPropagation();
        iniciarEdicaoCelula(this, itemId, campo, tipo);
      });
      
      // Também permite clique único se estiver no modo edição todos
      cell.addEventListener('click', function(e) {
        if (modoEdicaoTodos && this.classList.contains('editing-todos')) {
          e.stopPropagation();
          iniciarEdicaoCelula(this, itemId, campo, tipo);
        }
      });
    }

    function iniciarEdicaoCelula(cell, itemId, campo, tipo) {
      if (celulaEditando) return;
      
      celulaEditando = { cell, itemId, campo, tipo, valorOriginal: cell.textContent };
      
      // Salva o valor atual
      const valorAtual = cell.textContent.trim();
      
      // Limpa a célula
      cell.textContent = '';
      cell.classList.add('editing');
      
      let input;
      
      // Cria o input apropriado baseado no tipo
      if (tipo === 'select-status') {
        input = document.createElement('select');
        input.className = 'cell-select';
        input.innerHTML = `
          <option value="pendente" ${valorAtual === 'pendente' ? 'selected' : ''}>Pendente</option>
          <option value="aprovado" ${valorAtual === 'aprovado' ? 'selected' : ''}>Aprovado</option>
          <option value="recusado" ${valorAtual === 'recusado' ? 'selected' : ''}>Recusado</option>
        `;
      } else if (tipo === 'select-estado') {
        input = document.createElement('select');
        input.className = 'cell-select';
        input.innerHTML = `
          <option value="bom" ${valorAtual === 'bom' ? 'selected' : ''}>Bom</option>
          <option value="regular" ${valorAtual === 'regular' ? 'selected' : ''}>Regular</option>
          <option value="ruim" ${valorAtual === 'ruim' ? 'selected' : ''}>Ruim</option>
        `;
      } else if (tipo === 'textarea') {
        input = document.createElement('textarea');
        input.className = 'cell-textarea';
        input.value = valorAtual;
        input.rows = 3;
      } else if (tipo === 'number' || tipo === 'currency') {
        input = document.createElement('input');
        input.type = 'number';
        input.className = 'cell-input';
        input.step = tipo === 'currency' ? '0.01' : '1';
        input.value = valorAtual.replace('R$ ', '').replace('.', '').replace(',', '.');
      } else if (tipo === 'email') {
        input = document.createElement('input');
        input.type = 'email';
        input.className = 'cell-input';
        input.value = valorAtual;
      } else if (tipo === 'tel') {
        input = document.createElement('input');
        input.type = 'tel';
        input.className = 'cell-input';
        input.value = valorAtual;
      } else {
        input = document.createElement('input');
        input.type = 'text';
        input.className = 'cell-input';
        input.value = valorAtual;
      }
      
      // Adiciona o input à célula
      cell.appendChild(input);
      input.focus();
      
      // Seleciona todo o texto se for input de texto
      if (input.type === 'text' || input.type === 'email' || input.type === 'tel') {
        input.select();
      }
      
      // Eventos do input
      input.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
          finalizarEdicaoCelula(true);
        } else if (e.key === 'Escape') {
          finalizarEdicaoCelula(false);
        }
      });
      
      input.addEventListener('blur', function() {
        setTimeout(() => {
          if (celulaEditando && document.activeElement !== input) {
            finalizarEdicaoCelula(true);
          }
        }, 100);
      });
    }

    function finalizarEdicaoCelula(salvar) {
      if (!celulaEditando) return;
      
      const { cell, itemId, campo, tipo, valorOriginal } = celulaEditando;
      const input = cell.querySelector('input, select, textarea');
      
      let novoValor = salvar && input ? input.value.trim() : valorOriginal;
      
      // Limpa a célula
      cell.textContent = '';
      cell.classList.remove('editing');
      
      // Formata o valor se necessário
      if (salvar && input) {
        if (tipo === 'currency') {
          novoValor = formatarMoeda(parseFloat(novoValor) || 0);
        } else if (tipo === 'number') {
          novoValor = parseInt(novoValor) || 0;
        }
        
        // Atualiza o valor na célula
        cell.textContent = novoValor;
        
        // Atualiza o dado no array correspondente
        atualizarDado(itemId, campo, novoValor);
      } else {
        // Restaura o valor original
        cell.textContent = valorOriginal;
      }
      
      celulaEditando = null;
    }

    function atualizarDado(itemId, campo, valor) {
      // Determina em qual array está o item baseado no prefixo do ID
      let array, tipo;
      
      if (itemId.startsWith('cli_')) {
        array = clientes;
        tipo = 'cliente';
        itemId = itemId.replace('cli_', '');
      } else if (itemId.startsWith('for_')) {
        array = fornecedores;
        tipo = 'fornecedor';
        itemId = itemId.replace('for_', '');
      } else if (itemId.startsWith('orc_')) {
        array = orcamentos;
        tipo = 'orcamento';
        itemId = itemId.replace('orc_', '');
      } else if (itemId.startsWith('est_')) {
        array = estoque;
        tipo = 'estoque';
        itemId = itemId.replace('est_', '');
      } else if (itemId.startsWith('rec_')) {
        array = receber;
        tipo = 'receber';
        itemId = itemId.replace('rec_', '');
      } else if (itemId.startsWith('pag_')) {
        array = pagar;
        tipo = 'pagar';
        itemId = itemId.replace('pag_', '');
      } else if (itemId.startsWith('pat_')) {
        array = patrimonio;
        tipo = 'patrimonio';
        itemId = itemId.replace('pat_', '');
      } else if (itemId.startsWith('con_')) {
        array = contratos;
        tipo = 'contrato';
        itemId = itemId.replace('con_', '');
      }
      
      // Encontra o item e atualiza o campo
      const item = array.find(item => item.id === itemId);
      if (item) {
        item[campo] = valor;
        
        // Se for estoque, recalcula o status
        if (tipo === 'estoque' && (campo === 'quantidade' || campo === 'minimo')) {
          item.status = calcularStatusEstoque(item).texto;
        }
        
        // Se for orçamento e alterou o valor, recalcula formatação
        if (tipo === 'orcamento' && campo === 'valor') {
          valor = formatarMoeda(valor);
        }
        
        salvarDados();
        
        // Atualiza estatísticas se necessário
        if (tipo === 'estoque' || tipo === 'orcamento' || tipo === 'receber' || tipo === 'pagar') {
          atualizarEstatisticas();
        }
        
        // Mostra confirmação
        Swal.fire({
          title: 'Atualizado!',
          text: 'Campo atualizado com sucesso.',
          icon: 'success',
          timer: 1500,
          showConfirmButton: false
        });
      }
    }

    function salvarAlteracoesEmMassa(secao) {
      // Aqui você poderia implementar uma lógica para salvar múltiplas alterações
      // Por enquanto, apenas mostra uma mensagem
      Swal.fire({
        title: 'Alterações salvas!',
        text: 'Todas as alterações foram salvas automaticamente.',
        icon: 'success',
        timer: 2000,
        showConfirmButton: false
      });
    }

    // ==================== FUNÇÕES DE NAVEGAÇÃO ====================
    function mostrarDashboard(e) {
      if (e) e.preventDefault();
      secaoAtual = 'dashboard';
      atualizarNavbar();
      esconderTodasSecoes();
      $('#dashboard').style.display = 'block';
      atualizarEstatisticas();
      window.scrollTo(0, 0);
    }

    function mostrarSecao(secao) {
      secaoAtual = secao;
      atualizarNavbar();
      esconderTodasSecoes();
      $(`#${secao}`).style.display = 'block';
      
      // Carrega os dados da seção
      switch(secao) {
        case 'clientes':
          carregarClientes();
          break;
        case 'fornecedores':
          carregarFornecedores();
          break;
        case 'orcamentos':
          carregarOrcamentos();
          break;
        case 'estoque':
          carregarEstoque();
          break;
        case 'financeiro':
          carregarFinanceiro();
          break;
        case 'patrimonio':
          carregarPatrimonio();
          break;
        case 'contratos':
          carregarContratos();
          break;
        case 'relatorios':
          atualizarEstatisticas();
          break;
      }
      
      window.scrollTo(0, 0);
    }

    function atualizarNavbar() {
      $$('.nav-link-top').forEach(link => {
        link.classList.remove('active');
      });
      
      const linkAtivo = Array.from($$('.nav-link-top')).find(link => 
        link.textContent.includes(getTituloSecao(secaoAtual))
      );
      
      if (linkAtivo) {
        linkAtivo.classList.add('active');
      }
    }

    function getTituloSecao(secao) {
      const titulos = {
        'dashboard': 'Dashboard',
        'clientes': 'Clientes',
        'fornecedores': 'Fornecedores',
        'orcamentos': 'Orçamentos',
        'estoque': 'Estoque',
        'financeiro': 'Financeiro',
        'patrimonio': 'Patrimônio',
        'contratos': 'Contratos',
        'relatorios': 'Relatórios',
        'configuracoes': 'Configurações'
      };
      return titulos[secao] || secao;
    }

    function esconderTodasSecoes() {
      $$('.secao, #dashboard').forEach(secao => {
        secao.style.display = 'none';
      });
    }

    // ==================== FUNÇÕES UTILITÁRIAS ====================
    function formatarData(data) {
      if (!data) return '-';
      const date = new Date(data);
      return date.toLocaleDateString('pt-BR');
    }

    function formatarMoeda(valor) {
      return parseFloat(valor || 0).toLocaleString('pt-BR', {
        style: 'currency',
        currency: 'BRL'
      });
    }

    function gerarId() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }

    function salvarDados() {
      localStorage.setItem('clientes', JSON.stringify(clientes));
      localStorage.setItem('fornecedores', JSON.stringify(fornecedores));
      localStorage.setItem('orcamentos', JSON.stringify(orcamentos));
      localStorage.setItem('estoque', JSON.stringify(estoque));
      localStorage.setItem('receber', JSON.stringify(receber));
      localStorage.setItem('pagar', JSON.stringify(pagar));
      localStorage.setItem('patrimonio', JSON.stringify(patrimonio));
      localStorage.setItem('contratos', JSON.stringify(contratos));
      atualizarEstatisticas();
    }

    // ==================== FUNÇÕES DE CLIENTES ====================
    function adicionarCliente() {
      const nome = prompt('Nome do cliente:');
      if (nome) {
        const cliente = {
          id: gerarId(),
          nome: nome,
          telefone: '',
          email: '',
          endereco: '',
          dataCadastro: new Date().toISOString()
        };
        clientes.push(cliente);
        salvarDados();
        carregarClientes();
        Swal.fire('Sucesso!', 'Cliente adicionado com sucesso!', 'success');
      }
    }

    function adicionarClienteRapido() {
      const nome = prompt('Nome do cliente:');
      if (nome) {
        const cliente = {
          id: gerarId(),
          nome: nome,
          telefone: '',
          email: '',
          endereco: '',
          dataCadastro: new Date().toISOString()
        };
        clientes.push(cliente);
        salvarDados();
        carregarClientes();
        Swal.fire('Sucesso!', 'Cliente adicionado com sucesso!', 'success');
      }
    }

    function excluirCliente(id) {
      Swal.fire({
        title: 'Tem certeza?',
        text: "Esta ação não pode ser desfeita!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Sim, excluir!',
        cancelButtonText: 'Cancelar'
      }).then((result) => {
        if (result.isConfirmed) {
          clientes = clientes.filter(c => c.id !== id);
          salvarDados();
          carregarClientes();
          Swal.fire('Excluído!', 'Cliente removido com sucesso.', 'success');
        }
      });
    }

    function filtrarClientes() {
      const termo = $('#buscarCliente').value.toLowerCase();
      carregarClientes(termo);
    }

    function carregarClientes(filtro = '') {
      const tbody = $('#listaClientes');
      let clientesFiltrados = clientes;
      
      if (filtro) {
        clientesFiltrados = clientes.filter(c =>
          c.nome.toLowerCase().includes(filtro) ||
          (c.email && c.email.toLowerCase().includes(filtro)) ||
          (c.telefone && c.telefone.includes(filtro))
        );
      }

      if (clientesFiltrados.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="6" class="text-center py-4">
              <i class="bi bi-people display-4 text-muted mb-3 d-block"></i>
              <p class="text-muted">${filtro ? 'Nenhum cliente encontrado' : 'Nenhum cliente cadastrado'}</p>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = clientesFiltrados.map(cliente => `
        <tr>
          <td class="editable-cell" data-id="cli_${cliente.id}" data-field="nome">${cliente.nome}</td>
          <td class="editable-cell" data-id="cli_${cliente.id}" data-field="telefone">${cliente.telefone || ''}</td>
          <td class="editable-cell" data-id="cli_${cliente.id}" data-field="email">${cliente.email || ''}</td>
          <td class="editable-cell" data-id="cli_${cliente.id}" data-field="endereco">${cliente.endereco || ''}</td>
          <td class="non-editable-cell">${formatarData(cliente.dataCadastro)}</td>
          <td class="no-print">
            <button class="btn btn-sm btn-outline-danger" onclick="excluirCliente('${cliente.id}')">
              <i class="bi bi-trash"></i>
            </button>
          </td>
        </tr>
      `).join('');
      
      // Torna as células editáveis
      $$('#listaClientes .editable-cell').forEach(cell => {
        const itemId = cell.getAttribute('data-id');
        const campo = cell.getAttribute('data-field');
        let tipo = 'text';
        
        if (campo === 'email') tipo = 'email';
        if (campo === 'telefone') tipo = 'tel';
        
        tornarCelulaEditavel(cell, itemId, campo, tipo);
      });
    }

    // ==================== FUNÇÕES DE FORNECEDORES ====================
    function adicionarFornecedor() {
      const nome = prompt('Razão Social do fornecedor:');
      if (nome) {
        const fornecedor = {
          id: gerarId(),
          nome: nome,
          cnpj: '',
          telefone: '',
          email: '',
          dataCadastro: new Date().toISOString()
        };
        fornecedores.push(fornecedor);
        salvarDados();
        carregarFornecedores();
        Swal.fire('Sucesso!', 'Fornecedor adicionado com sucesso!', 'success');
      }
    }

    function carregarFornecedores() {
      const tbody = $('#listaFornecedores');
      
      if (fornecedores.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="5" class="text-center py-4">
              <i class="bi bi-truck display-4 text-muted mb-3 d-block"></i>
              <p class="text-muted">Nenhum fornecedor cadastrado</p>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = fornecedores.map(fornecedor => `
        <tr>
          <td class="editable-cell" data-id="for_${fornecedor.id}" data-field="nome">${fornecedor.nome}</td>
          <td class="editable-cell" data-id="for_${fornecedor.id}" data-field="cnpj">${fornecedor.cnpj || ''}</td>
          <td class="editable-cell" data-id="for_${fornecedor.id}" data-field="telefone">${fornecedor.telefone || ''}</td>
          <td class="editable-cell" data-id="for_${fornecedor.id}" data-field="email">${fornecedor.email || ''}</td>
          <td class="no-print">
            <button class="btn btn-sm btn-outline-danger" onclick="excluirFornecedor('${fornecedor.id}')">
              <i class="bi bi-trash"></i>
            </button>
          </td>
        </tr>
      `).join('');
      
      // Torna as células editáveis
      $$('#listaFornecedores .editable-cell').forEach(cell => {
        const itemId = cell.getAttribute('data-id');
        const campo = cell.getAttribute('data-field');
        let tipo = 'text';
        
        if (campo === 'email') tipo = 'email';
        if (campo === 'telefone') tipo = 'tel';
        if (campo === 'cnpj') tipo = 'text';
        
        tornarCelulaEditavel(cell, itemId, campo, tipo);
      });
    }

    function excluirFornecedor(id) {
      Swal.fire({
        title: 'Excluir Fornecedor',
        text: "Tem certeza que deseja excluir este fornecedor?",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Sim, excluir',
        cancelButtonText: 'Cancelar'
      }).then((result) => {
        if (result.isConfirmed) {
          fornecedores = fornecedores.filter(f => f.id !== id);
          salvarDados();
          carregarFornecedores();
          Swal.fire('Excluído!', 'Fornecedor removido com sucesso.', 'success');
        }
      });
    }

    // ==================== FUNÇÕES DE ORÇAMENTOS ====================
    function adicionarOrcamento() {
      if (clientes.length === 0) {
        Swal.fire('Atenção', 'Cadastre primeiro um cliente!', 'warning');
        return;
      }
      
      let clientesList = clientes.map((c, i) => `${i + 1}. ${c.nome}`).join('\n');
      const clienteIndex = prompt(`Clientes disponíveis:\n${clientesList}\n\nDigite o número do cliente:`);
      const index = parseInt(clienteIndex) - 1;
      
      if (isNaN(index) || index < 0 || index >= clientes.length) {
        Swal.fire('Erro', 'Cliente inválido!', 'error');
        return;
      }
      
      const cliente = clientes[index];
      const descricao = prompt('Descrição do orçamento:');
      
      if (!descricao) return;
      
      const valorStr = prompt('Valor do orçamento (R$):');
      const valor = parseFloat(valorStr) || 0;
      
      const orcamento = {
        id: gerarId(),
        clienteId: cliente.id,
        clienteNome: cliente.nome,
        descricao: descricao,
        valor: valor,
        status: 'pendente',
        data: new Date().toISOString()
      };
      
      orcamentos.push(orcamento);
      salvarDados();
      carregarOrcamentos();
      Swal.fire('Sucesso!', 'Orçamento criado com sucesso!', 'success');
    }

    function adicionarOrcamentoRapido() {
      if (clientes.length === 0) {
        Swal.fire('Atenção', 'Cadastre primeiro um cliente!', 'warning');
        return;
      }
      
      const cliente = clientes[0];
      const descricao = prompt('Descrição do orçamento:');
      if (!descricao) return;
      
      const valorStr = prompt('Valor do orçamento (R$):');
      const valor = parseFloat(valorStr) || 0;
      
      const orcamento = {
        id: gerarId(),
        clienteId: cliente.id,
        clienteNome: cliente.nome,
        descricao: descricao,
        valor: valor,
        status: 'pendente',
        data: new Date().toISOString()
      };
      
      orcamentos.push(orcamento);
      salvarDados();
      carregarOrcamentos();
      Swal.fire('Sucesso!', 'Orçamento criado com sucesso!', 'success');
    }

    function filtrarOrcamentos() {
      const status = $('#filtroStatus').value;
      carregarOrcamentos(status);
    }

    function carregarOrcamentos(filtroStatus = 'todos') {
      const tbody = $('#listaOrcamentos');
      let orcamentosFiltrados = orcamentos;
      
      if (filtroStatus !== 'todos') {
        orcamentosFiltrados = orcamentos.filter(o => o.status === filtroStatus);
      }
      
      if (orcamentosFiltrados.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="7" class="text-center py-4">
              <i class="bi bi-calculator display-4 text-muted mb-3 d-block"></i>
              <p class="text-muted">${filtroStatus !== 'todos' ? 'Nenhum orçamento com esse status' : 'Nenhum orçamento cadastrado'}</p>
            </td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = orcamentosFiltrados.map((orcamento, index) => {
        let statusClass = 'bg-secondary';
        if (orcamento.status === 'aprovado') statusClass = 'bg-success';
        if (orcamento.status === 'pendente') statusClass = 'bg-warning';
        if (orcamento.status === 'recusado') statusClass = 'bg-danger';
        
        return `
          <tr>
            <td class="non-editable-cell">${index + 1}</td>
            <td class="editable-cell" data-id="orc_${orcamento.id}" data-field="clienteNome">${orcamento.clienteNome}</td>
            <td class="editable-cell" data-id="orc_${orcamento.id}" data-field="descricao" data-type="textarea">${orcamento.descricao}</td>
            <td class="editable-cell" data-id="orc_${orcamento.id}" data-field="valor" data-type="currency">${formatarMoeda(orcamento.valor)}</td>
            <td class="non-editable-cell">${formatarData(orcamento.data)}</td>
            <td class="editable-cell" data-id="orc_${orcamento.id}" data-field="status" data-type="select-status">
              <span class="badge ${statusClass}">${orcamento.status}</span>
            </td>
            <td class="no-print">
              <button class="btn btn-sm btn-outline-danger" onclick="excluirOrcamento('${orcamento.id}')">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
        `;
      }).join('');
      
      // Torna as células editáveis
      $$('#listaOrcamentos .editable-cell').forEach(cell => {
        const itemId = cell.getAttribute('data-id');
        const campo = cell.getAttribute('data-field');
        const tipo = cell.getAttribute('data-type') || 'text';
        
        tornarCelulaEditavel(cell, itemId, campo, tipo);
      });
    }

    function excluirOrcamento(id) {
      Swal.fire({
        title: 'Excluir Orçamento',
        text: "Tem certeza que deseja excluir este orçamento?",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Sim, excluir',
        cancelButtonText: 'Cancelar'
      }).then((result) => {
        if (result.isConfirmed) {
          orcamentos = orcamentos.filter(o => o.id !== id);
          salvarDados();
          carregarOrcamentos();
          Swal.fire('Excluído!', 'Orçamento removido com sucesso.', 'success');
        }
      });
    }

    // ==================== FUNÇÕES DE ESTOQUE ====================
    function adicionarItemEstoque() {
      const produto = prompt('Nome do produto:');
      if (!produto) return;
      
      const quantidadeStr = prompt('Quantidade:');
      const quantidade = parseInt(quantidadeStr) || 0;
      
      const minimoStr = prompt('Estoque mínimo:');
      const minimo = parseInt(minimoStr) || 5;
      
      const item = {
        id: gerarId(),
        produto: produto,
        quantidade: quantidade,
        minimo: minimo,
        fornecedor: '',
        valorUnitario: 0,
        status: calcularStatusEstoque({quantidade, minimo}).texto,
        dataCadastro: new Date().toISOString()
      };
      
      estoque.push(item);
      salvarDados();
      carregarEstoque();
      Swal.fire('Sucesso!', 'Item adicionado ao estoque!', 'success');
    }

    function adicionarEstoqueRapido() {
      if (estoque.length === 0) {
        Swal.fire('Atenção', 'Primeiro cadastre um item no estoque!', 'warning');
        return;
      }
      
      const item = estoque[0];
      const quantidadeStr = prompt(`Quantidade a adicionar ao ${item.produto} (atual: ${item.quantidade}):`);
      const quantidade = parseInt(quantidadeStr) || 0;
      
      item.quantidade += quantidade;
      item.status = calcularStatusEstoque(item).texto;
      salvarDados();
      carregarEstoque();
      Swal.fire('Sucesso!', `${quantidade} unidades adicionadas ao ${item.produto}!`, 'success');
    }

    function calcularStatusEstoque(item) {
      const porcentagem = (item.quantidade / item.minimo) * 100;
      
      if (porcentagem <= 30) {
        return { classe: 'badge-estoque-baixo', texto: 'BAIXO', linha: 'table-danger' };
      } else if (porcentagem <= 60) {
        return { classe: 'badge-estoque-medio', texto: 'ATENÇÃO', linha: 'table-warning' };
      } else {
        return { classe: 'badge-estoque-ok', texto: 'OK', linha: '' };
      }
    }

    function carregarEstoque() {
      const tbody = $('#listaEstoque');
      
      if (estoque.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="7" class="text-center py-4">
              <i class="bi bi-box display-4 text-muted mb-3 d-block"></i>
              <p class="text-muted">Nenhum item no estoque</p>
            </td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = estoque.map(item => {
        const status = calcularStatusEstoque(item);
        
        return `
          <tr class="${status.linha}">
            <td class="editable-cell" data-id="est_${item.id}" data-field="produto">${item.produto}</td>
            <td class="editable-cell" data-id="est_${item.id}" data-field="quantidade" data-type="number">${item.quantidade}</td>
            <td class="editable-cell" data-id="est_${item.id}" data-field="minimo" data-type="number">${item.minimo}</td>
            <td class="editable-cell" data-id="est_${item.id}" data-field="fornecedor">${item.fornecedor || ''}</td>
            <td class="editable-cell" data-id="est_${item.id}" data-field="valorUnitario" data-type="currency">${formatarMoeda(item.valorUnitario)}</td>
            <td class="non-editable-cell">
              <span class="badge ${status.classe}">${status.texto}</span>
            </td>
            <td class="no-print">
              <button class="btn btn-sm btn-outline-danger" onclick="excluirItemEstoque('${item.id}')">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
        `;
      }).join('');
      
      // Torna as células editáveis
      $$('#listaEstoque .editable-cell').forEach(cell => {
        const itemId = cell.getAttribute('data-id');
        const campo = cell.getAttribute('data-field');
        const tipo = cell.getAttribute('data-type') || 'text';
        
        tornarCelulaEditavel(cell, itemId, campo, tipo);
      });
    }

    function excluirItemEstoque(id) {
      Swal.fire({
        title: 'Excluir Item',
        text: "Tem certeza que deseja excluir este item do estoque?",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Sim, excluir',
        cancelButtonText: 'Cancelar'
      }).then((result) => {
        if (result.isConfirmed) {
          estoque = estoque.filter(e => e.id !== id);
          salvarDados();
          carregarEstoque();
          Swal.fire('Excluído!', 'Item removido do estoque.', 'success');
        }
      });
    }

    // ==================== FUNÇÕES FINANCEIRAS ====================
    function adicionarContaReceber() {
      const descricao = prompt('Descrição da conta a receber:');
      if (!descricao) return;
      
      const valorStr = prompt('Valor (R$):');
      const valor = parseFloat(valorStr) || 0;
      
      const conta = {
        id: gerarId(),
        descricao: descricao,
        valor: valor,
        data: new Date().toISOString()
      };
      
      receber.push(conta);
      salvarDados();
      carregarFinanceiro();
      Swal.fire('Sucesso!', 'Conta a receber adicionada!', 'success');
    }

    function adicionarContaPagar() {
      const descricao = prompt('Descrição da conta a pagar:');
      if (!descricao) return;
      
      const valorStr = prompt('Valor (R$):');
      const valor = parseFloat(valorStr) || 0;
      
      const conta = {
        id: gerarId(),
        descricao: descricao,
        valor: valor,
        data: new Date().toISOString()
      };
      
      pagar.push(conta);
      salvarDados();
      carregarFinanceiro();
      Swal.fire('Sucesso!', 'Conta a pagar adicionada!', 'success');
    }

    function carregarFinanceiro() {
      carregarContasReceber();
      carregarContasPagar();
      atualizarSaldo();
    }

    function carregarContasReceber() {
      const tbody = $('#listaReceber');
      
      if (receber.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="3" class="text-center text-muted">Nenhuma conta a receber</td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = receber.map((conta, index) => `
        <tr>
          <td class="editable-cell" data-id="rec_${conta.id}" data-field="descricao">${conta.descricao}</td>
          <td class="editable-cell" data-id="rec_${conta.id}" data-field="valor" data-type="currency">${formatarMoeda(conta.valor)}</td>
          <td class="no-print">
            <button class="btn btn-sm btn-outline-danger" onclick="removerContaReceber('${conta.id}')">
              <i class="bi bi-trash"></i>
            </button>
          </td>
        </tr>
      `).join('');
      
      // Torna as células editáveis
      $$('#listaReceber .editable-cell').forEach(cell => {
        const itemId = cell.getAttribute('data-id');
        const campo = cell.getAttribute('data-field');
        const tipo = cell.getAttribute('data-type') || 'text';
        
        tornarCelulaEditavel(cell, itemId, campo, tipo);
      });
    }

    function carregarContasPagar() {
      const tbody = $('#listaPagar');
      
      if (pagar.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="3" class="text-center text-muted">Nenhuma conta a pagar</td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = pagar.map((conta, index) => `
        <tr>
          <td class="editable-cell" data-id="pag_${conta.id}" data-field="descricao">${conta.descricao}</td>
          <td class="editable-cell" data-id="pag_${conta.id}" data-field="valor" data-type="currency">${formatarMoeda(conta.valor)}</td>
          <td class="no-print">
            <button class="btn btn-sm btn-outline-danger" onclick="removerContaPagar('${conta.id}')">
              <i class="bi bi-trash"></i>
            </button>
          </td>
        </tr>
      `).join('');
      
      // Torna as células editáveis
      $$('#listaPagar .editable-cell').forEach(cell => {
        const itemId = cell.getAttribute('data-id');
        const campo = cell.getAttribute('data-field');
        const tipo = cell.getAttribute('data-type') || 'text';
        
        tornarCelulaEditavel(cell, itemId, campo, tipo);
      });
    }

    function removerContaReceber(id) {
      receber = receber.filter(c => c.id !== id);
      salvarDados();
      carregarFinanceiro();
      Swal.fire('Removido!', 'Conta a receber removida.', 'success');
    }

    function removerContaPagar(id) {
      pagar = pagar.filter(c => c.id !== id);
      salvarDados();
      carregarFinanceiro();
      Swal.fire('Removido!', 'Contra a pagar removida.', 'success');
    }

    function atualizarSaldo() {
      const totalReceber = receber.reduce((s, v) => s + parseFloat(v.valor || 0), 0);
      const totalPagar = pagar.reduce((s, v) => s + parseFloat(v.valor || 0), 0);
      const saldo = totalReceber - totalPagar;
      
      $('#totalReceitas').textContent = formatarMoeda(totalReceber);
      $('#totalDespesas').textContent = formatarMoeda(totalPagar);
      $('#saldoAtual').textContent = formatarMoeda(saldo);
      
      const alert = $('#saldoAlert');
      alert.className = `alert ${saldo >= 0 ? 'alert-success' : 'alert-danger'}`;
      $('#saldoAtual').className = saldo >= 0 ? 'saldo-positivo' : 'saldo-negativo';
    }

    // ==================== FUNÇÕES DE PATRIMÔNIO ====================
    function adicionarPatrimonio() {
      const item = prompt('Descrição do item:');
      if (!item) return;
      
      const valorStr = prompt('Valor do item (R$):');
      const valor = parseFloat(valorStr) || 0;
      
      const patrimonioItem = {
        id: gerarId(),
        nome: item,
        valor: valor,
        dataAquisicao: new Date().toISOString(),
        departamento: 'Geral',
        estado: 'bom'
      };
      
      patrimonio.push(patrimonioItem);
      salvarDados();
      carregarPatrimonio();
      Swal.fire('Sucesso!', 'Item adicionado ao patrimônio!', 'success');
    }

    function carregarPatrimonio() {
      const tbody = $('#listaPatrimonio');
      
      if (patrimonio.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="6" class="text-center py-4">
              <i class="bi bi-building display-4 text-muted mb-3 d-block"></i>
              <p class="text-muted">Nenhum item no patrimônio</p>
            </td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = patrimonio.map(item => {
        let estadoClass = 'bg-success';
        if (item.estado === 'regular') estadoClass = 'bg-warning';
        if (item.estado === 'ruim') estadoClass = 'bg-danger';
        
        return `
          <tr>
            <td class="editable-cell" data-id="pat_${item.id}" data-field="nome">${item.nome}</td>
            <td class="non-editable-cell">${formatarData(item.dataAquisicao)}</td>
            <td class="editable-cell" data-id="pat_${item.id}" data-field="valor" data-type="currency">${formatarMoeda(item.valor)}</td>
            <td class="editable-cell" data-id="pat_${item.id}" data-field="departamento">${item.departamento}</td>
            <td class="editable-cell" data-id="pat_${item.id}" data-field="estado" data-type="select-estado">
              <span class="badge ${estadoClass}">${item.estado}</span>
            </td>
            <td class="no-print">
              <button class="btn btn-sm btn-outline-danger" onclick="excluirPatrimonio('${item.id}')">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
        `;
      }).join('');
      
      // Torna as células editáveis
      $$('#listaPatrimonio .editable-cell').forEach(cell => {
        const itemId = cell.getAttribute('data-id');
        const campo = cell.getAttribute('data-field');
        const tipo = cell.getAttribute('data-type') || 'text';
        
        tornarCelulaEditavel(cell, itemId, campo, tipo);
      });
    }

    function excluirPatrimonio(id) {
      Swal.fire({
        title: 'Excluir Item',
        text: "Tem certeza que deseja excluir este item do patrimônio?",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Sim, excluir',
        cancelButtonText: 'Cancelar'
      }).then((result) => {
        if (result.isConfirmed) {
          patrimonio = patrimonio.filter(p => p.id !== id);
          salvarDados();
          carregarPatrimonio();
          Swal.fire('Excluído!', 'Item removido do patrimônio.', 'success');
        }
      });
    }

    // ==================== FUNÇÕES DE CONTRATOS ====================
    function adicionarContrato() {
      if (clientes.length === 0) {
        Swal.fire('Atenção', 'Cadastre primeiro um cliente!', 'warning');
        return;
      }
      
      const cliente = clientes[0];
      const descricao = prompt('Descrição do contrato:');
      
      if (!descricao) return;
      
      const contrato = {
        id: gerarId(),
        clienteId: cliente.id,
        clienteNome: cliente.nome,
        descricao: descricao,
        data: new Date().toISOString(),
        status: 'ativo'
      };
      
      contratos.push(contrato);
      salvarDados();
      carregarContratos();
      Swal.fire('Sucesso!', 'Contrato criado com sucesso!', 'success');
    }

    function carregarContratos() {
      const container = $('#listaContratos');
      
      if (contratos.length === 0) {
        container.innerHTML = `
          <div class="col-12">
            <div class="empty-state">
              <i class="bi bi-file-earmark-text"></i>
              <h5>Nenhum contrato</h5>
              <p>Comece criando seu primeiro contrato</p>
            </div>
          </div>
        `;
        return;
      }
      
      container.innerHTML = contratos.map(contrato => `
        <div class="col-md-6 mb-3">
          <div class="card h-100">
            <div class="card-body">
              <h6 class="card-title editable-cell" data-id="con_${contrato.id}" data-field="clienteNome">${contrato.clienteNome}</h6>
              <p class="card-text text-muted small editable-cell" data-id="con_${contrato.id}" data-field="descricao" data-type="textarea">${contrato.descricao.substring(0, 100)}...</p>
              <div class="d-flex justify-content-between align-items-center mt-3">
                <small class="text-muted non-editable-cell">${formatarData(contrato.data)}</small>
                <button class="btn btn-sm btn-outline-danger" onclick="excluirContrato('${contrato.id}')">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      `).join('');
      
      // Torna as células editáveis nos contratos
      $$('#listaContratos .editable-cell').forEach(cell => {
        const itemId = cell.getAttribute('data-id');
        const campo = cell.getAttribute('data-field');
        const tipo = cell.getAttribute('data-type') || 'text';
        
        tornarCelulaEditavel(cell, itemId, campo, tipo);
      });
    }

    function excluirContrato(id) {
      Swal.fire({
        title: 'Excluir Contrato',
        text: "Tem certeza que deseja excluir este contrato?",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Sim, excluir',
        cancelButtonText: 'Cancelar'
      }).then((result) => {
        if (result.isConfirmed) {
          contratos = contratos.filter(c => c.id !== id);
          salvarDados();
          carregarContratos();
          Swal.fire('Excluído!', 'Contrato removido com sucesso.', 'success');
        }
      });
    }

    // ==================== FUNÇÕES DE IMPRESSÃO ====================
    function imprimirSecaoAtual() {
      if (secaoAtual === 'dashboard') {
        imprimirRelatorioCompleto();
      } else {
        window.print();
      }
    }

    function imprimirRelatorioCompleto() {
      const receberTotal = receber.reduce((s, v) => s + parseFloat(v.valor || 0), 0);
      const pagarTotal = pagar.reduce((s, v) => s + parseFloat(v.valor || 0), 0);
      const saldo = receberTotal - pagarTotal;
      const itensBaixos = estoque.filter(item => calcularStatusEstoque(item).texto === 'BAIXO').length;
      
      const html = `
        <div style="padding: 20px; font-family: Arial, sans-serif;">
          <h2 style="text-align: center; color: #2c3e50;">Relatório Completo do Sistema</h2>
          <h4 style="text-align: center; color: #666;">MarcenariaPro - ${new Date().toLocaleDateString('pt-BR')}</h4>
          
          <hr style="margin: 20px 0; border-color: #2c3e50;">
          
          <h3 style="color: #2c3e50;">1. Resumo Geral</h3>
          <table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
            <tr>
              <td style="padding: 8px; border-bottom: 1px solid #ddd;"><strong>Total de Clientes:</strong></td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;">${clientes.length}</td>
            </tr>
            <tr>
              <td style="padding: 8px; border-bottom: 1px solid #ddd;"><strong>Orçamentos Pendentes:</strong></td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;">${orcamentos.filter(o => o.status === 'pendente').length}</td>
            </tr>
            <tr>
              <td style="padding: 8px; border-bottom: 1px solid #ddd;"><strong>Itens em Estoque:</strong></td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;">${estoque.length}</td>
            </tr>
            <tr>
              <td style="padding: 8px; border-bottom: 1px solid #ddd;"><strong>Itens com Estoque Baixo:</strong></td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right; ${itensBaixos > 0 ? 'color: red;' : ''}">${itensBaixos}</td>
            </tr>
          </table>
          
          <h3 style="color: #2c3e50; margin-top: 30px;">2. Resumo Financeiro</h3>
          <table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
            <tr>
              <td style="padding: 8px; border-bottom: 1px solid #ddd;"><strong>Total de Receitas:</strong></td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;">${formatarMoeda(receberTotal)}</td>
            </tr>
            <tr>
              <td style="padding: 8px; border-bottom: 1px solid #ddd;"><strong>Total de Despesas:</strong></td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;">${formatarMoeda(pagarTotal)}</td>
            </tr>
            <tr style="background: #f8f9fa;">
              <td style="padding: 8px; border-bottom: 1px solid #ddd;"><strong>SALDO ATUAL:</strong></td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right; ${saldo >= 0 ? 'color: green;' : 'color: red;'}">${formatarMoeda(saldo)}</td>
            </tr>
          </table>
          
          <div style="margin-top: 30px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
            <p style="margin: 0; text-align: center;"><strong>Relatório gerado automaticamente pelo sistema MarcenariaPro</strong></p>
          </div>
        </div>
      `;
      
      const janela = window.open('', '_blank');
      janela.document.write(html);
      janela.document.close();
      setTimeout(() => {
        janela.print();
        janela.close();
      }, 500);
    }

    function imprimirRelatorioFinanceiro() {
      const receberTotal = receber.reduce((s, v) => s + parseFloat(v.valor || 0), 0);
      const pagarTotal = pagar.reduce((s, v) => s + parseFloat(v.valor || 0), 0);
      const saldo = receberTotal - pagarTotal;
      
      const html = `
        <div style="padding: 20px; font-family: Arial, sans-serif;">
          <h2 style="text-align: center; color: #2c3e50;">Relatório Financeiro</h2>
          <h4 style="text-align: center; color: #666;">MarcenariaPro - ${new Date().toLocaleDateString('pt-BR')}</h4>
          
          <div style="margin: 20px 0;">
            <h3>Contas a Receber (${receber.length})</h3>
            <table style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="background: #f8f9fa;">
                  <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Descrição</th>
                  <th style="padding: 10px; text-align: right; border-bottom: 2px solid #ddd;">Valor</th>
                </tr>
              </thead>
              <tbody>
                ${receber.map(conta => `
                  <tr>
                    <td style="padding: 8px; border-bottom: 1px solid #ddd;">${conta.descricao}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;">${formatarMoeda(conta.valor)}</td>
                  </tr>
                `).join('') || '<tr><td colspan="2" style="padding: 8px; text-align: center;">Nenhuma conta a receber</td></tr>'}
                <tr style="background: #f8f9fa;">
                  <td style="padding: 8px; border-bottom: 1px solid #ddd;"><strong>TOTAL:</strong></td>
                  <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;"><strong>${formatarMoeda(receberTotal)}</strong></td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div style="margin: 20px 0;">
            <h3>Contas a Pagar (${pagar.length})</h3>
            <table style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="background: #f8f9fa;">
                  <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Descrição</th>
                  <th style="padding: 10px; text-align: right; border-bottom: 2px solid #ddd;">Valor</th>
                </tr>
              </thead>
              <tbody>
                ${pagar.map(conta => `
                  <tr>
                    <td style="padding: 8px; border-bottom: 1px solid #ddd;">${conta.descricao}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;">${formatarMoeda(conta.valor)}</td>
                  </tr>
                `).join('') || '<tr><td colspan="2" style="padding: 8px; text-align: center;">Nenhuma conta a pagar</td></tr>'}
                <tr style="background: #f8f9fa;">
                  <td style="padding: 8px; border-bottom: 1px solid #ddd;"><strong>TOTAL:</strong></td>
                  <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;"><strong>${formatarMoeda(pagarTotal)}</strong></td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div style="margin: 30px 0; padding: 20px; background: ${saldo >= 0 ? '#d4edda' : '#f8d7da'}; border-radius: 5px;">
            <h3 style="text-align: center; margin: 0; color: ${saldo >= 0 ? '#155724' : '#721c24'}">
              Saldo Atual: ${formatarMoeda(saldo)}
            </h3>
          </div>
        </div>
      `;
      
      const janela = window.open('', '_blank');
      janela.document.write(html);
      janela.document.close();
      setTimeout(() => {
        janela.print();
        janela.close();
      }, 500);
    }

    function imprimirRelatorioEstoque() {
      const itensBaixos = estoque.filter(item => calcularStatusEstoque(item).texto === 'BAIXO').length;
      const valorTotal = estoque.reduce((s, item) => s + (item.quantidade * (item.valorUnitario || 0)), 0);
      
      const html = `
        <div style="padding: 20px; font-family: Arial, sans-serif;">
          <h2 style="text-align: center; color: #2c3e50;">Relatório de Estoque</h2>
          <h4 style="text-align: center; color: #666;">MarcenariaPro - ${new Date().toLocaleDateString('pt-BR')}</h4>
          
          <div style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 5px;">
            <p><strong>Total de Itens:</strong> ${estoque.length}</p>
            <p><strong>Itens com Estoque Baixo:</strong> <span style="${itensBaixos > 0 ? 'color: red;' : ''}">${itensBaixos}</span></p>
            <p><strong>Valor Total em Estoque:</strong> ${formatarMoeda(valorTotal)}</p>
          </div>
          
          <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
            <thead>
              <tr style="background: #f8f9fa;">
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Produto</th>
                <th style="padding: 10px; text-align: center; border-bottom: 2px solid #ddd;">Quantidade</th>
                <th style="padding: 10px; text-align: center; border-bottom: 2px solid #ddd;">Mínimo</th>
                <th style="padding: 10px; text-align: center; border-bottom: 2px solid #ddd;">Status</th>
              </tr>
            </thead>
            <tbody>
              ${estoque.map(item => {
                const status = calcularStatusEstoque(item);
                const rowStyle = status.texto === 'BAIXO' ? 'background: #f8d7da;' : status.texto === 'ATENÇÃO' ? 'background: #fff3cd;' : '';
                return `
                  <tr style="${rowStyle}">
                    <td style="padding: 8px; border-bottom: 1px solid #ddd;">${item.produto}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: center;">${item.quantidade}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: center;">${item.minimo}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: center;">
                      <span style="display: inline-block; padding: 3px 8px; border-radius: 3px; 
                        background: ${status.texto === 'BAIXO' ? '#dc3545' : status.texto === 'ATENÇÃO' ? '#ffc107' : '#28a745'}; 
                        color: ${status.texto === 'ATENÇÃO' ? '#000' : '#fff'};">
                        ${status.texto}
                      </span>
                    </td>
                  </tr>
                `;
              }).join('')}
            </tbody>
          </table>
          
          ${itensBaixos > 0 ? `
            <div style="margin: 20px 0; padding: 15px; background: #fff3cd; border-radius: 5px;">
              <p style="margin: 0;"><strong>Atenção:</strong> ${itensBaixos} ${itensBaixos === 1 ? 'item necessita' : 'itens necessitam'} de reposição urgente.</p>
            </div>
          ` : ''}
        </div>
      `;
      
      const janela = window.open('', '_blank');
      janela.document.write(html);
      janela.document.close();
      setTimeout(() => {
        janela.print();
        janela.close();
      }, 500);
    }

    function imprimirRelatorioClientes() {
      const html = `
        <div style="padding: 20px; font-family: Arial, sans-serif;">
          <h2 style="text-align: center; color: #2c3e50;">Relatório de Clientes</h2>
          <h4 style="text-align: center; color: #666;">MarcenariaPro - ${new Date().toLocaleDateString('pt-BR')}</h4>
          
          <div style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 5px;">
            <p><strong>Total de Clientes:</strong> ${clientes.length}</p>
          </div>
          
          <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
            <thead>
              <tr style="background: #f8f9fa;">
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Nome</th>
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Telefone</th>
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">E-mail</th>
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Data Cadastro</th>
              </tr>
            </thead>
            <tbody>
              ${clientes.map(cliente => `
                <tr>
                  <td style="padding: 8px; border-bottom: 1px solid #ddd;">${cliente.nome}</td>
                  <td style="padding: 8px; border-bottom: 1px solid #ddd;">${cliente.telefone || '-'}</td>
                  <td style="padding: 8px; border-bottom: 1px solid #ddd;">${cliente.email || '-'}</td>
                  <td style="padding: 8px; border-bottom: 1px solid #ddd;">${formatarData(cliente.dataCadastro)}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      `;
      
      const janela = window.open('', '_blank');
      janela.document.write(html);
      janela.document.close();
      setTimeout(() => {
        janela.print();
        janela.close();
      }, 500);
    }

    // ==================== FUNÇÕES DE EXPORTAÇÃO ====================
    function exportarDados() {
      const dados = {
        clientes: clientes,
        fornecedores: fornecedores,
        orcamentos: orcamentos,
        estoque: estoque,
        receber: receber,
        pagar: pagar,
        patrimonio: patrimonio,
        contratos: contratos,
        dataExportacao: new Date().toISOString()
      };
      
      const json = JSON.stringify(dados, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `backup-marcenaria-${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      Swal.fire('Sucesso!', 'Dados exportados com sucesso!', 'success');
    }

    // ==================== FUNÇÕES DE ESTATÍSTICAS ====================
    function atualizarEstatisticas() {
      // Atualiza contadores
      $('#totalClientes').textContent = clientes.length;
      $('#totalOrcamentos').textContent = orcamentos.length;
      $('#estoqueBaixo').textContent = estoque.filter(item => calcularStatusEstoque(item).texto === 'BAIXO').length;
      
      // Atualiza saldo
      const receberTotal = receber.reduce((s, v) => s + parseFloat(v.valor || 0), 0);
      const pagarTotal = pagar.reduce((s, v) => s + parseFloat(v.valor || 0), 0);
      const saldo = receberTotal - pagarTotal;
      $('#saldoResumo').textContent = formatarMoeda(saldo);
      
      // Atualiza cor do saldo
      const elementoSaldo = $('#saldoResumo');
      elementoSaldo.className = saldo >= 0 ? 'saldo-positivo' : 'saldo-negativo';
    }

    // ==================== INICIALIZAÇÃO ====================
    function inicializar() {
      // Mostra o dashboard inicialmente
      mostrarDashboard();
      
      // Inicializa dados de exemplo se necessário
      if (clientes.length === 0) {
        clientes = [
          {
            id: gerarId(),
            nome: 'João Silva',
            telefone: '(11) 99999-8888',
            email: 'joao@exemplo.com',
            endereco: 'Rua das Flores, 123',
            dataCadastro: new Date().toISOString()
          }
        ];
      }
      
      if (estoque.length === 0) {
        estoque = [
          {
            id: gerarId(),
            produto: 'MDF 15mm',
            quantidade: 10,
            minimo: 20,
            fornecedor: 'Madeireira Central',
            valorUnitario: 89.90,
            status: 'ATENÇÃO',
            dataCadastro: new Date().toISOString()
          }
        ];
      }
      
      if (receber.length === 0) {
        receber = [
          {
            id: gerarId(),
            descricao: 'Mesa de Jantar',
            valor: 1200.00,
            data: new Date().toISOString()
          }
        ];
      }
      
      if (pagar.length === 0) {
        pagar = [
          {
            id: gerarId(),
            descricao: 'Compra de Madeira',
            valor: 850.00,
            data: new Date().toISOString()
          }
        ];
      }
      
      // Salva os dados iniciais
      salvarDados();
      
      // Atualiza as estatísticas
      atualizarEstatisticas();
    }

    // Inicia o sistema quando a página carrega
    document.addEventListener('DOMContentLoaded', inicializar);
    
    // Adiciona listener para teclas globais
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && celulaEditando) {
        finalizarEdicaoCelula(false);
      }
    });
  </script>
</body>
</html>